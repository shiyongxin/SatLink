<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculation Details - SatLink</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="/">SatLink</a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/dashboard">Dashboard</a>
                <a class="nav-link" href="/calculate">Calculate</a>
                <a class="nav-link" href="/calculations">Calculations</a>
                <a class="nav-link" href="/manage">Manage</a>
                <a class="nav-link" href="/public">Public</a>
                <a class="nav-link" href="/profile">Profile</a>
                <a class="nav-link" href="/logout">Logout</a>
            </div>
        </div>
    </nav>

    <div class="container mt-5">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>Calculation Details</h1>
            <a href="/calculations" class="btn btn-secondary">Back to Calculations</a>
        </div>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ 'danger' if category == 'error' else 'success' }} alert-dismissible fade show">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <div class="row">
            <div class="col-md-6">
                <div class="card mb-4">
                    <div class="card-header">
                        <h5>Calculation Information</h5>
                    </div>
                    <div class="card-body">
                        <table class="table table-sm">
                            <tr><th>ID:</th><td>{{ calculation.id }}</td></tr>
                            <tr><th>Name:</th><td>{{ calculation.name }}</td></tr>
                            <tr><th>Date:</th><td>{{ calculation.calculation_date }}</td></tr>
                            <tr><th>Satellite ID:</th><td>{{ calculation.satellite_id }}</td></tr>
                            <tr><th>Transponder ID:</th><td>{{ calculation.transponder_id }}</td></tr>
                            <tr><th>Carrier ID:</th><td>{{ calculation.carrier_id }}</td></tr>
                            <tr><th>Ground Station ID:</th><td>{{ calculation.ground_station_id }}</td></tr>
                            <tr><th>Reception Type:</th><td>{{ calculation.reception_type }}</td></tr>
                        </table>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card mb-4">
                    <div class="card-header bg-success text-white">
                        <h5>Link Results</h5>
                    </div>
                    <div class="card-body">
                        <table class="table table-striped table-sm">
                            <tr><td>Elevation Angle:</td><td>{{ "%.2f"|format(calculation.elevation_angle) }}°</td></tr>
                            <tr><td>Azimuth Angle:</td><td>{{ "%.2f"|format(calculation.azimuth_angle) }}°</td></tr>
                            <tr><td>Distance:</td><td>{{ "%.0f"|format(calculation.distance) }} km</td></tr>
                            <tr><td>Free Space Loss:</td><td>{{ "%.2f"|format(calculation.a_fs) }} dB</td></tr>
                            <tr><td>Total Loss:</td><td>{{ "%.2f"|format(calculation.a_tot) }} dB</td></tr>
                            <tr><td>C/N0:</td><td>{{ "%.2f"|format(calculation.cn0) }} dB-Hz</td></tr>
                            <tr><td>SNR:</td><td>{{ "%.2f"|format(calculation.snr) }} dB</td></tr>
                            <tr><td>Link Margin:</td><td>{{ "%.2f"|format(calculation.link_margin) }} dB</td></tr>
                            <tr><td>Availability:</td><td>{{ "%.1f"|format(calculation.availability) }}%</td></tr>
                            <tr><td>G/T:</td><td>{{ "%.2f"|format(calculation.gt_value) }} dB/K</td></tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h5>Atmospheric Attenuation Breakdown</h5>
                    </div>
                    <div class="card-body">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Parameter</th>
                                    <th>Value (dB)</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Gas Attenuation</td>
                                    <td>{{ "%.2f"|format(calculation.a_g) }}</td>
                                    <td>Atmospheric gas absorption (oxygen, water vapor)</td>
                                </tr>
                                <tr>
                                    <td>Cloud Attenuation</td>
                                    <td>{{ "%.2f"|format(calculation.a_c) }}</td>
                                    <td>Cloud and fog attenuation</td>
                                </tr>
                                <tr>
                                    <td>Rain Attenuation</td>
                                    <td>{{ "%.2f"|format(calculation.a_r) }}</td>
                                    <td>Rain attenuation (ITU-R P.618)</td>
                                </tr>
                                <tr>
                                    <td>Scintillation</td>
                                    <td>{{ "%.2f"|format(calculation.a_s) }}</td>
                                    <td>Tropospheric scintillation</td>
                                </tr>
                                <tr class="table-primary">
                                    <td><strong>Total Atmospheric</strong></td>
                                    <td><strong>{{ "%.2f"|format(calculation.a_t) }}</strong></td>
                                    <td><strong>Sum of all atmospheric effects</strong></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h5>Link Performance</h5>
                    </div>
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-md-3">
                                <div class="card bg-light">
                                    <div class="card-body">
                                        <h6>C/N0</h6>
                                        <h3>{{ "%.2f"|format(calculation.cn0) }}</h3>
                                        <p class="text-muted">dB-Hz</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card bg-light">
                                    <div class="card-body">
                                        <h6>SNR</h6>
                                        <h3>{{ "%.2f"|format(calculation.snr) }}</h3>
                                        <p class="text-muted">dB</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card {{ 'bg-success' if calculation.link_margin > 0 else 'bg-danger' }} text-white">
                                    <div class="card-body">
                                        <h6>Link Margin</h6>
                                        <h3>{{ "%.2f"|format(calculation.link_margin) }}</h3>
                                        <p class="text-muted">dB</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card {{ 'bg-success' if calculation.availability > 99 else 'bg-warning' if calculation.availability > 95 else 'bg-danger' }} text-white">
                                    <div class="card-body">
                                        <h6>Availability</h6>
                                        <h3>{{ "%.1f"|format(calculation.availability) }}%</h3>
                                        <p class="text-muted">Annual</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
