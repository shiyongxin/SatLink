<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Reception Systems - SatLink</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="/">SatLink</a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/dashboard">Dashboard</a>
                <a class="nav-link" href="/logout">Logout</a>
            </div>
        </div>
    </nav>

    <div class="container mt-5">
        <div class="row">
            <div class="col-md-12">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2>Manage Reception Systems</h2>
                    <div>
                        <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addComplexModal">
                            Add Complex System
                        </button>
                        <button type="button" class="btn btn-info" data-bs-toggle="modal" data-bs-target="#addSimpleModal">
                            Add Simple System
                        </button>
                    </div>
                </div>

                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            <div class="alert alert-{{ 'danger' if category == 'error' else 'success' }} alert-dismissible fade show">
                                {{ message }}
                                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                            </div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}

                <!-- Complex Reception Systems -->
                <div class="card mb-4">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0">Complex Reception Systems</h5>
                        <small>Detailed antenna and LNB parameters</small>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Antenna (m)</th>
                                        <th>Efficiency</th>
                                        <th>LNB Gain (dB)</th>
                                        <th>LNB Temp (K)</th>
                                        <th>G/T (dB/K)</th>
                                        <th>Shared</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for system in complex_systems %}
                                    <tr data-system-id="{{ system.id }}" data-system-type="complex">
                                        <td>
                                            <strong>{{ system.name }}</strong>
                                            {% if system.manufacturer or system.model %}
                                                <br><small class="text-muted">{{ system.manufacturer or '' }} {{ system.model or '' }}</small>
                                            {% endif %}
                                        </td>
                                        <td>{{ system.ant_size }}</td>
                                        <td>{{ "%.2f"|format(system.ant_eff) }}</td>
                                        <td>{{ system.lnb_gain }}</td>
                                        <td>{{ system.lnb_temp }}</td>
                                        <td><strong>{{ "%.1f"|format(system.calculated_gt) if system.calculated_gt else '-' }}</strong></td>
                                        <td class="shared-badge">
                                            {% if system.is_shared %}
                                                <span class="badge bg-success">Public</span>
                                            {% else %}
                                                <span class="badge bg-secondary">Private</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            <button type="button" class="btn btn-sm btn-warning edit-complex-btn" data-id="{{ system.id }}">Edit</button>
                                            <form method="POST" action="/manage/reception_complex/{{ system.id }}/delete" style="display: inline;">
                                                <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure?')">Delete</button>
                                            </form>
                                            <button type="button"
                                                    class="btn btn-sm btn-{{ 'success' if system.is_shared else 'info' }} share-toggle-btn"
                                                    data-system-id="{{ system.id }}"
                                                    data-system-type="complex"
                                                    data-is-shared="{{ 1 if system.is_shared else 0 }}">
                                                {{ 'Make Private' if system.is_shared else 'Make Public' }}
                                            </button>
                                        </td>
                                    </tr>
                                    {% else %}
                                    <tr>
                                        <td colspan="8" class="text-center">No complex reception systems found.</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Simple Reception Systems -->
                <div class="card">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">Simple Reception Systems</h5>
                        <small>Direct G/T value input</small>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>G/T (dB/K)</th>
                                        <th>Frequency (GHz)</th>
                                        <th>Measurement</th>
                                        <th>Shared</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for system in simple_systems %}
                                    <tr data-system-id="{{ system.id }}" data-system-type="simple">
                                        <td>
                                            <strong>{{ system.name }}</strong>
                                            {% if system.manufacturer or system.model %}
                                                <br><small class="text-muted">{{ system.manufacturer or '' }} {{ system.model or '' }}</small>
                                            {% endif %}
                                        </td>
                                        <td><strong>{{ "%.1f"|format(system.gt_value) }}</strong></td>
                                        <td>{{ "%.3f"|format(system.frequency) if system.frequency else '-' }}</td>
                                        <td>{{ system.measurement_method or '-' }}</td>
                                        <td class="shared-badge">
                                            {% if system.is_shared %}
                                                <span class="badge bg-success">Public</span>
                                            {% else %}
                                                <span class="badge bg-secondary">Private</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            <button type="button" class="btn btn-sm btn-warning edit-simple-btn" data-id="{{ system.id }}">Edit</button>
                                            <form method="POST" action="/manage/reception_simple/{{ system.id }}/delete" style="display: inline;">
                                                <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure?')">Delete</button>
                                            </form>
                                            <button type="button"
                                                    class="btn btn-sm btn-{{ 'success' if system.is_shared else 'info' }} share-toggle-btn"
                                                    data-system-id="{{ system.id }}"
                                                    data-system-type="simple"
                                                    data-is-shared="{{ 1 if system.is_shared else 0 }}">
                                                {{ 'Make Private' if system.is_shared else 'Make Public' }}
                                            </button>
                                        </td>
                                    </tr>
                                    {% else %}
                                    <tr>
                                        <td colspan="6" class="text-center">No simple reception systems found.</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Complex System Modal -->
    <div class="modal fade" id="addComplexModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title">Add Complex Reception System</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form method="POST" action="/manage/reception_complex/add">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label">Name *</label>
                            <input type="text" class="form-control" name="name" required>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Antenna Size (m) *</label>
                                <input type="number" step="0.1" class="form-control" name="ant_size" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Antenna Efficiency *</label>
                                <input type="number" step="0.01" class="form-control" name="ant_eff" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">LNB Gain (dB) *</label>
                                <input type="number" step="0.1" class="form-control" name="lnb_gain" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label class="form-label">LNB Temp (K) *</label>
                                <input type="number" step="1" class="form-control" name="lnb_temp" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Coupling Loss (dB)</label>
                                <input type="number" step="0.1" class="form-control" name="coupling_loss" value="0">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Cable Loss (dB)</label>
                                <input type="number" step="0.1" class="form-control" name="cable_loss" value="0">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Polarization Loss (dB)</label>
                                <input type="number" step="0.1" class="form-control" name="polarization_loss" value="3">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Max Depoint (°)</label>
                                <input type="number" step="0.01" class="form-control" name="max_depoint" value="0">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Manufacturer</label>
                                <input type="text" class="form-control" name="manufacturer">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Model</label>
                                <input type="text" class="form-control" name="model">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Description</label>
                                <input type="text" class="form-control" name="description">
                            </div>
                        </div>
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="is_shared" id="complexShared">
                                <label class="form-check-label" for="complexShared">
                                    Share publicly
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-success">Add System</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Simple System Modal -->
    <div class="modal fade" id="addSimpleModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-info text-white">
                    <h5 class="modal-title">Add Simple Reception System</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form method="POST" action="/manage/reception_simple/add">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label">Name *</label>
                            <input type="text" class="form-control" name="name" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">G/T Value (dB/K) *</label>
                            <input type="number" step="0.1" class="form-control" name="gt_value" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Depoint Loss (dB)</label>
                            <input type="number" step="0.1" class="form-control" name="depoint_loss" value="0">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Frequency (GHz)</label>
                            <input type="number" step="0.001" class="form-control" name="frequency">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Measurement Method</label>
                            <select class="form-select" name="measurement_method">
                                <option value="">Select...</option>
                                <option value="Measured">Measured</option>
                                <option value="Calculated">Calculated</option>
                                <option value="Estimated">Estimated</option>
                                <option value="Manufacturer">Manufacturer Spec</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Manufacturer</label>
                            <input type="text" class="form-control" name="manufacturer">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Model</label>
                            <input type="text" class="form-control" name="model">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Description</label>
                            <input type="text" class="form-control" name="description">
                        </div>
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="is_shared" id="simpleShared">
                                <label class="form-check-label" for="simpleShared">
                                    Share publicly
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-info">Add System</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Complex System Modal -->
    <div class="modal fade" id="editComplexModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-warning text-white">
                    <h5 class="modal-title">Edit Complex Reception System</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form method="POST" id="editComplexForm">
                    <input type="hidden" name="system_id" id="editComplexId">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label">Name *</label>
                            <input type="text" class="form-control" name="name" id="editComplexName" required>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Antenna Size (m) *</label>
                                <input type="number" step="0.1" class="form-control" name="ant_size" id="editComplexAntSize" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Antenna Efficiency *</label>
                                <input type="number" step="0.01" class="form-control" name="ant_eff" id="editComplexAntEff" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">LNB Gain (dB) *</label>
                                <input type="number" step="0.1" class="form-control" name="lnb_gain" id="editComplexLnbGain" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label class="form-label">LNB Temp (K) *</label>
                                <input type="number" step="1" class="form-control" name="lnb_temp" id="editComplexLnbTemp" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Coupling Loss (dB)</label>
                                <input type="number" step="0.1" class="form-control" name="coupling_loss" id="editComplexCouplingLoss" value="0">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Cable Loss (dB)</label>
                                <input type="number" step="0.1" class="form-control" name="cable_loss" id="editComplexCableLoss" value="0">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Polarization Loss (dB)</label>
                                <input type="number" step="0.1" class="form-control" name="polarization_loss" id="editComplexPolarizationLoss" value="3">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Max Depoint (°)</label>
                                <input type="number" step="0.01" class="form-control" name="max_depoint" id="editComplexMaxDepoint" value="0">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Manufacturer</label>
                                <input type="text" class="form-control" name="manufacturer" id="editComplexManufacturer">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Model</label>
                                <input type="text" class="form-control" name="model" id="editComplexModel">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Description</label>
                                <input type="text" class="form-control" name="description" id="editComplexDescription">
                            </div>
                        </div>
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="is_shared" id="editComplexShared">
                                <label class="form-check-label" for="editComplexShared">
                                    Share publicly
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-warning">Update System</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Simple System Modal -->
    <div class="modal fade" id="editSimpleModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-warning text-white">
                    <h5 class="modal-title">Edit Simple Reception System</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form method="POST" id="editSimpleForm">
                    <input type="hidden" name="system_id" id="editSimpleId">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label">Name *</label>
                            <input type="text" class="form-control" name="name" id="editSimpleName" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">G/T Value (dB/K) *</label>
                            <input type="number" step="0.1" class="form-control" name="gt_value" id="editSimpleGtValue" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Depoint Loss (dB)</label>
                            <input type="number" step="0.1" class="form-control" name="depoint_loss" id="editSimpleDepointLoss" value="0">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Frequency (GHz)</label>
                            <input type="number" step="0.001" class="form-control" name="frequency" id="editSimpleFrequency">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Measurement Method</label>
                            <select class="form-select" name="measurement_method" id="editSimpleMeasurementMethod">
                                <option value="">Select...</option>
                                <option value="Measured">Measured</option>
                                <option value="Calculated">Calculated</option>
                                <option value="Estimated">Estimated</option>
                                <option value="Manufacturer">Manufacturer Spec</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Manufacturer</label>
                            <input type="text" class="form-control" name="manufacturer" id="editSimpleManufacturer">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Model</label>
                            <input type="text" class="form-control" name="model" id="editSimpleModel">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Description</label>
                            <input type="text" class="form-control" name="description" id="editSimpleDescription">
                        </div>
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="is_shared" id="editSimpleShared">
                                <label class="form-check-label" for="editSimpleShared">
                                    Share publicly
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-warning">Update System</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Store complex systems data
        const complexSystems = {
            {% for system in complex_systems %}
            {{ system.id }}: {
                id: {{ system.id }},
                name: '{{ system.name }}',
                ant_size: {{ system.ant_size }},
                ant_eff: {{ system.ant_eff }},
                lnb_gain: {{ system.lnb_gain }},
                lnb_temp: {{ system.lnb_temp }},
                coupling_loss: {{ system.coupling_loss or 0 }},
                cable_loss: {{ system.cable_loss or 0 }},
                polarization_loss: {{ system.polarization_loss or 3 }},
                max_depoint: {{ system.max_depoint or 0 }},
                manufacturer: '{{ system.manufacturer or '' }}',
                model: '{{ system.model or '' }}',
                description: '{{ system.description or '' }}',
                is_shared: {{ 'true' if system.is_shared else 'false' }}
            },
            {% endfor %}
        };

        // Store simple systems data
        const simpleSystems = {
            {% for system in simple_systems %}
            {{ system.id }}: {
                id: {{ system.id }},
                name: '{{ system.name }}',
                gt_value: {{ system.gt_value }},
                depoint_loss: {{ system.depoint_loss or 0 }},
                frequency: {{ system.frequency or 'null' }},
                measurement_method: '{{ system.measurement_method or '' }}',
                manufacturer: '{{ system.manufacturer or '' }}',
                model: '{{ system.model or '' }}',
                description: '{{ system.description or '' }}',
                is_shared: {{ 'true' if system.is_shared else 'false' }}
            },
            {% endfor %}
        };

        // Edit complex system
        document.querySelectorAll('.edit-complex-btn').forEach(button => {
            button.addEventListener('click', function() {
                const id = this.getAttribute('data-id');
                const system = complexSystems[id];

                document.getElementById('editComplexId').value = id;
                document.getElementById('editComplexName').value = system.name;
                document.getElementById('editComplexAntSize').value = system.ant_size;
                document.getElementById('editComplexAntEff').value = system.ant_eff;
                document.getElementById('editComplexLnbGain').value = system.lnb_gain;
                document.getElementById('editComplexLnbTemp').value = system.lnb_temp;
                document.getElementById('editComplexCouplingLoss').value = system.coupling_loss;
                document.getElementById('editComplexCableLoss').value = system.cable_loss;
                document.getElementById('editComplexPolarizationLoss').value = system.polarization_loss;
                document.getElementById('editComplexMaxDepoint').value = system.max_depoint;
                document.getElementById('editComplexManufacturer').value = system.manufacturer;
                document.getElementById('editComplexModel').value = system.model;
                document.getElementById('editComplexDescription').value = system.description;
                document.getElementById('editComplexShared').checked = system.is_shared;

                document.getElementById('editComplexForm').action = '/manage/reception_complex/' + id + '/edit';

                const modal = new bootstrap.Modal(document.getElementById('editComplexModal'));
                modal.show();
            });
        });

        // Edit simple system
        document.querySelectorAll('.edit-simple-btn').forEach(button => {
            button.addEventListener('click', function() {
                const id = this.getAttribute('data-id');
                const system = simpleSystems[id];

                document.getElementById('editSimpleId').value = id;
                document.getElementById('editSimpleName').value = system.name;
                document.getElementById('editSimpleGtValue').value = system.gt_value;
                document.getElementById('editSimpleDepointLoss').value = system.depoint_loss;
                document.getElementById('editSimpleFrequency').value = system.frequency || '';
                document.getElementById('editSimpleMeasurementMethod').value = system.measurement_method;
                document.getElementById('editSimpleManufacturer').value = system.manufacturer;
                document.getElementById('editSimpleModel').value = system.model;
                document.getElementById('editSimpleDescription').value = system.description;
                document.getElementById('editSimpleShared').checked = system.is_shared;

                document.getElementById('editSimpleForm').action = '/manage/reception_simple/' + id + '/edit';

                const modal = new bootstrap.Modal(document.getElementById('editSimpleModal'));
                modal.show();
            });
        });

        // Handle share toggle buttons
        document.querySelectorAll('.share-toggle-btn').forEach(button => {
            button.addEventListener('click', async function() {
                const systemId = this.getAttribute('data-system-id');
                const systemType = this.getAttribute('data-system-type');
                const isShared = this.getAttribute('data-is-shared') === '1';
                const row = document.querySelector(`tr[data-system-id="${systemId}"][data-system-type="${systemType}"]`);

                // Disable button during request
                this.disabled = true;
                const originalText = this.textContent;
                this.textContent = 'Loading...';

                try {
                    const url = systemType === 'complex'
                        ? `/manage/reception_complex/${systemId}/share`
                        : `/manage/reception_simple/${systemId}/share`;

                    const response = await fetch(url, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        }
                    });

                    const data = await response.json();

                    if (data.success) {
                        // Update the badge
                        const badgeCell = row.querySelector('.shared-badge');
                        if (data.is_shared) {
                            badgeCell.innerHTML = '<span class="badge bg-success">Public</span>';
                        } else {
                            badgeCell.innerHTML = '<span class="badge bg-secondary">Private</span>';
                        }

                        // Update the button
                        this.setAttribute('data-is-shared', data.is_shared ? '1' : '0');
                        this.className = `btn btn-sm btn-${data.is_shared ? 'success' : 'info'} share-toggle-btn`;
                        this.textContent = data.is_shared ? 'Make Private' : 'Make Public';

                        // Show success message
                        const alertDiv = document.createElement('div');
                        alertDiv.className = 'alert alert-success alert-dismissible fade show';
                        alertDiv.style.position = 'fixed';
                        alertDiv.style.top = '20px';
                        alertDiv.style.right = '20px';
                        alertDiv.style.zIndex = '9999';
                        alertDiv.innerHTML = `
                            ${data.message || 'Sharing status updated successfully'}
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        `;
                        document.body.appendChild(alertDiv);

                        // Auto-remove after 3 seconds
                        setTimeout(() => {
                            alertDiv.remove();
                        }, 3000);
                    } else {
                        // Show error
                        alert('Error: ' + (data.error || 'Failed to update sharing status'));
                        this.textContent = originalText;
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert('Network error: ' + error.message);
                    this.textContent = originalText;
                } finally {
                    this.disabled = false;
                }
            });
        });
    </script>
</body>
</html>
